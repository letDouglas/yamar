apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: yamar-ingress
  namespace: default
  annotations:
    # -------------------------------------------------------------------------
    # ðŸ—ï¸ ARCHITECTURAL NOTE: DNS STRATEGY
    # -------------------------------------------------------------------------
    # FOR DEVELOPMENT (CURRENT):
    # We use "Magic DNS" (nip.io) to map '127.0.0.1.nip.io' to localhost.
    # REASON: This allows "Zero-Config" setup for any developer cloning the repo,
    # avoiding the need for manual administrative edits to /etc/hosts files.
    #
    # FOR PRODUCTION:
    # This host field would be templated (via Helm) to a real domain (e.g., api.yamar.com).
    # -------------------------------------------------------------------------

    # -------------------------------------------------------------------------
    # PROXY TUNING (Production-Grade)
    # -------------------------------------------------------------------------
    # Allow larger uploads (images for Product Service)
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"

    # Increase buffer size to handle large OIDC/OAuth2 Identity Tokens headers
    nginx.ingress.kubernetes.io/proxy-buffer-size: "16k"

    # Pass the Host header effectively to backend services (Crucial for OAuth2)
    nginx.ingress.kubernetes.io/upstream-vhost: $host

spec:
  ingressClassName: nginx

  rules:
    # -------------------------------------------------------------------------
    # ROUTE 1: API GATEWAY
    # URL: http://api.127.0.0.1.nip.io
    # Resolves to: 127.0.0.1 -> Ingress Controller -> Gateway Service (9090)
    # -------------------------------------------------------------------------
    - host: api.127.0.0.1.nip.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: gateway-service
                port:
                  number: 9090